[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Parsers_File /fluent-bit/etc/parsers.conf
    Parsers_File /fluentbit/parsers.conf

# INPUT: Zeek logs (JSON via policy/tuning/json-logs)
[INPUT]
    Name              tail
    Path              /logs/zeek/*.log
    Exclude_Path      /logs/zeek/loaded_scripts.log,/logs/zeek/telemetry.log
    Tag               zeek.*
    Parser            json
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /fluentbit/state/zeek.db

# INPUT: Suricata eve.json
[INPUT]
    Name              tail
    Path              /logs/suricata/eve.json
    Tag               suricata.eve
    Parser            json
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /fluentbit/state/suricata_eve.db

# INPUT: Syslog (TCP + UDP) on 5514
[INPUT]
    Name            syslog
    Mode            tcp
    Listen          0.0.0.0
    Port            5514
    Tag             syslog.tcp
    Parser          syslog-rfc3164

[INPUT]
    Name            syslog
    Mode            udp
    Listen          0.0.0.0
    Port            5514
    Tag             syslog.udp
    Parser          syslog-rfc3164

# Tag records by source
[FILTER]
    Name            modify
    Match           zeek.*
    Add             source zeek

[FILTER]
    Name            modify
    Match           suricata.eve
    Add             source suricata

[FILTER]
    Name            modify
    Match           syslog.*
    Add             source syslog

# OUTPUT: OpenSearch (GeoIP handled by index default_pipeline)
[OUTPUT]
    Name            es
    Match           *
    Host            ${OPENSEARCH_HOST}
    Port            ${OPENSEARCH_PORT}
    HTTP_User       ${OPENSEARCH_USER}
    HTTP_Passwd     ${OPENSEARCH_PASS}
    Index           fluentbit-default
    Logstash_Format Off
    Suppress_Type_Name On
    tls             On
    tls.verify      Off
