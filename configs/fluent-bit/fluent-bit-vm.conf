# ███████████████████████████████████████████████████████████████
# FLUENT BIT CONFIG - APACHE LOGS TO OPENSEARCH (PARSED)
# ███████████████████████████████████████████████████████████████
# Purpose: Ship Apache access logs from GCP VM to QNAP OpenSearch
# Feature: Parses Apache combined log format into structured fields
# Fields: client_ip, timestamp, method, path, protocol, status,
#         size, referrer, user_agent
# ███████████████████████████████████████████████████████████████

[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

# ███████████████████████████████████████████████████████████████
# INPUT: Brian Chaplow Portfolio Site
# ███████████████████████████████████████████████████████████████
[INPUT]
    Name             tail
    Path             /var/log/apache2/brianchaplow-https-access.log
    Tag              apache.brianchaplow
    Parser           apache_stalker
    Read_from_Head   False

# ███████████████████████████████████████████████████████████████
# INPUT: Bytes Bourbon BBQ Site  
# ███████████████████████████████████████████████████████████████
[INPUT]
    Name             tail
    Path             /var/log/apache2/bytesbourbonbbq-https-access.log
    Tag              apache.bytesbourbonbbq
    Parser           apache_stalker
    Read_from_Head   False

# ███████████████████████████████████████████████████████████████
# FILTER: Add site name field based on tag
# ███████████████████████████████████████████████████████████████
[FILTER]
    Name          record_modifier
    Match         apache.brianchaplow
    Record        site brianchaplow.com

[FILTER]
    Name          record_modifier
    Match         apache.bytesbourbonbbq
    Record        site bytesbourbonbbq.com

# ███████████████████████████████████████████████████████████████
# OUTPUT: OpenSearch on QNAP via Tailscale
# ███████████████████████████████████████████████████████████████
[OUTPUT]
    Name             opensearch
    Match            apache.*
    Host             ${OPENSEARCH_HOST}
    Port             ${OPENSEARCH_PORT}
    HTTP_User        ${OPENSEARCH_USER}
    HTTP_Passwd      ${OPENSEARCH_PASS}
    Index            apache-parsed-v2
    tls              On
    tls.verify       Off
    Suppress_Type_Name On
    Pipeline         apache-geoip

@INCLUDE honeypot.conf
