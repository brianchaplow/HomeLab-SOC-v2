# ============================================================================
# FLUENT BIT - HONEYPOT LOG SHIPPING
# Add this to your existing /etc/fluent-bit/fluent-bit.conf on GCP VM
# ============================================================================

# ----------------------------------------------------------------------------
# INPUT: Honeypot credential logs (JSON format)
# ----------------------------------------------------------------------------
[INPUT]
    Name              tail
    Tag               honeypot.credentials
    Path              /var/log/honeypot/credentials.json
    Parser            json
    DB                /var/lib/fluent-bit/honeypot-creds.db
    Mem_Buf_Limit     10MB
    Refresh_Interval  5
    Read_from_Head    True

# ----------------------------------------------------------------------------
# INPUT: Honeypot Apache access logs (Combined format)
# ----------------------------------------------------------------------------
[INPUT]
    Name              tail
    Tag               honeypot.access
    Path              /var/log/apache2/honeypot-access.log
    Parser            apache_combined
    DB                /var/lib/fluent-bit/honeypot-access.db
    Mem_Buf_Limit     5MB
    Refresh_Interval  10

# ----------------------------------------------------------------------------
# FILTER: Add metadata to honeypot logs
# ----------------------------------------------------------------------------
[FILTER]
    Name              modify
    Match             honeypot.*
    Add               log_type honeypot
    Add               research_project INST570
    Add               data_classification sensitive
    Add               source_system gcp-vm

# ----------------------------------------------------------------------------
# OUTPUT: Ship to OpenSearch on QNAP (via Tailscale)
# ----------------------------------------------------------------------------
[OUTPUT]
    Name              opensearch
    Match             honeypot.credentials
    Host              ${OPENSEARCH_HOST}
    Port              ${OPENSEARCH_PORT}
    HTTP_User         ${OPENSEARCH_USER}
    HTTP_Passwd       ${OPENSEARCH_PASS}
    Index             honeypot-credentials
    Suppress_Type_Name On
    tls               On
    tls.verify        Off
    Retry_Limit       5

[OUTPUT]
    Name              opensearch
    Match             honeypot.access
    Host              ${OPENSEARCH_HOST}
    Port              ${OPENSEARCH_PORT}
    HTTP_User         ${OPENSEARCH_USER}
    HTTP_Passwd       ${OPENSEARCH_PASS}
    Index             honeypot-access
    Suppress_Type_Name On
    tls               On
    tls.verify        Off
    Retry_Limit       5
